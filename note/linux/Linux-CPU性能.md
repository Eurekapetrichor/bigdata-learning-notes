

---


# 一、平均负载
## 1.1 查看系统负载
当发现系统变慢的时候, 通常都会使用 `top` 或 `uptime` 查看系统负载情况:
```bash
# top
[root@k8s-master ~]# top
top - 11:24:51 up 59 min,  2 users,  load average: 0.32, 0.24, 0.18
...

# uptime
[root@k8s-master ~]# uptime
 11:24:51 up 59 min,  2 users,  load average: 0.32, 0.24, 0.18
```
各个值的说明:
- 11:24:51: 系统时间
- up 59 min: 系统运行时间
- 2 users: 登录到系统的人数
- 0.32, 0.24, 0.18: 分别代表过去1、5、15分钟的**平均负载(Load Average)**
    
## 1.2 平均负载的介绍

关于平均负载的详细解释可以使用: `man uptime` 查看官方解释;

简单来说, 平均负载是指单位时间内, 系统处于**可运行状态**和**不可中断状态**的平均进程数, 也就是**平均活跃进程数**, 它和 CPU 使用率并没有直接关系。
- 可运行状态: 正在使用 CPU 或正在等待CPU的进程, 就是 `ps -aux` 命令看到的那些处于 R 的进程;
- 不可中断状态: 整处在内核关键状态的进程, 通常都是不可被打断的进程, 例如等待设备I/O响应 的, 也就是 `ps -aux` 命令处于 D 状态的进程.

平均负载其实就是平均活跃的进程数(如上面解释, 包括可运行状态进程、不可中断状态进程), 包括等待I/O的进程, 也就是说 I/O 操作也会造成平均负载增高.

## 1.3 平均负载合理值范围
既然平均负载是活跃的进程数, 那么最理想的就是每个CPU上都运行这一个进程, 这样每个 CPU 都得到充分的利用

例如: 平均负载为2, 代表着:
- 在只有两个CPU的系统上, 代表所有CPU的负载都刚好被占用完;
- 在只有四个CPU的系统上, 代表CPU有一半的空闲;
- 在只有一个CPU的系统上, 代表有一半的进程得不到CPU, 一直在相互竞争CPU的使用权;

所以得出结论: 平均负载最理想就是=CPU个数

首先我们通过如下命令查看CPU个数:
```bash
[root@k8s-master ~]# cat /proc/cpuinfo| grep "physical id"| sort| uniq| wc -l
2
```
有了CPU个数, 就可以通过 `top` 或 `uptime` 判断出平均负载的情况了

关于这个命令显示的最后三个参数(1、5、15分钟的平均负载), 再做如下解释:
- 当 1分钟负载小于 15分钟负载时: 表示服务器负载情况正在降低;
- 当 1分钟负载基本等于 15分钟负载时: 表示服务器负载情况很稳定;
- 当 1分钟负载大于 15分钟负载时: 表示服务器负载情况正在上升, 这种情况是我们需要注意的, 因为这种增加可能是暂时的, 也可能回一直增加下去, 一旦 1分钟负载超过(接近)了 CPU个数, 就意味着发生过载, 需要查原因了.



# 二、CPU上下文切换

# 三、CPU使用100%

# 四、Linux软中断

# 五、快速分析CPU瓶颈

# 六、CPU性能分析的思路